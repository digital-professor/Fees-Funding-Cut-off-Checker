<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fee & Funding Deadline Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  body {
    font-family: 'Inter', sans-serif;
  }
</style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

<div class="w-full max-w-2xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 space-y-6">
    <div class="text-center">
        <h1 class="text-3xl font-bold text-white">Fee & Funding Deadline Checker</h1>
        <p class="text-gray-400 mt-2">Enter course and enrolment dates to see key deadlines.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="md:col-span-1">
        <label for="courseStart" class="block text-sm font-medium text-gray-300 mb-2">Official course start date</label>
        <input type="date" id="courseStart" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 transition"/>
      </div>
      <div class="md:col-span-1">
        <label for="enrolDate" class="block text-sm font-medium text-gray-300 mb-2">Enrolment date</label>
        <input type="date" id="enrolDate" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 transition"/>
      </div>
      <div class="md:col-span-1">
        <label for="isHsc" class="block text-sm font-medium text-gray-300 mb-2">Is this an HSC course?</label>
        <select id="isHsc" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 transition">
          <option value="no" selected>No (most courses)</option>
          <option value="yes">Yes (HSC)</option>
        </select>
      </div>
    </div>

    <button onclick="checkDates()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">Check Deadlines</button>

    <div id="output" class="result pt-4" aria-live="polite"></div>
</div>

<script>
function toggleDetails() {
  const details = document.getElementById('deadlineDetails');
  const arrow = document.getElementById('details-arrow');
  details.classList.toggle('hidden');
  arrow.classList.toggle('rotate-180');
}

function d(val) {
  const dt = new Date(val);
  return new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());
}

function addDays(date, days) {
  const r = new Date(date);
  r.setDate(r.getDate() + days);
  return r;
}

function formatDate(date) {
  return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
}

function formatDaysLeft(diff) {
    if (diff > 0) {
        return `(${diff} ${diff === 1 ? 'day' : 'days'} left)`;
    } else if (diff < 0) {
        const daysAgo = Math.abs(diff);
        return `(${daysAgo} ${daysAgo === 1 ? 'day' : 'days'} ago)`;
    } else {
        return `(Today is the deadline)`;
    }
}

function checkDates() {
  const courseStartRaw = document.getElementById('courseStart').value;
  const enrolDateRaw   = document.getElementById('enrolDate').value;
  const isHsc          = document.getElementById('isHsc').value === 'yes';

  const out = document.getElementById('output');

  if (!courseStartRaw || !enrolDateRaw) {
    out.innerHTML = `<div class="bg-red-900/50 border border-red-700 text-red-300 rounded-lg p-4 flex items-center gap-3"><i class='fas fa-exclamation-circle'></i><span>Please enter both dates.</span></div>`;
    return;
  }

  const courseStart = d(courseStartRaw);
  const enrolDate   = d(enrolDateRaw);
  const today       = d(new Date());

  // SFE rule (external)
  const sfeDeadline = addDays(courseStart, -1);

  // LSBU rule (internal)
  const fourteenDayAnchor = (enrolDate <= courseStart) ? courseStart : enrolDate;
  const fourteenDayDeadline = addDays(fourteenDayAnchor, 14);
  const cohortCap = isHsc ? d("2025-10-06") : d("2025-10-20");
  const lsbuFeeLiabilityDeadline = (fourteenDayDeadline > cohortCap) ? fourteenDayDeadline : cohortCap;

  const sfeStillInTime  = today <= sfeDeadline;
  const lsbuStillInTime = today <= lsbuFeeLiabilityDeadline;

  const sfeDaysDiff = Math.ceil((sfeDeadline - today) / (1000 * 60 * 60 * 24));
  const lsbuDaysDiff = Math.ceil((lsbuFeeLiabilityDeadline - today) / (1000 * 60 * 60 * 24));

  const sfeDaysText = formatDaysLeft(sfeDaysDiff);
  const lsbuDaysText = formatDaysLeft(lsbuDaysDiff);

  const sfeStatusIcon = sfeStillInTime ? '✅' : '❌';
  const lsbuStatusIcon = lsbuStillInTime ? '✅' : '❌';
  
  const sfeDateColorClass = sfeStillInTime ? 'text-green-400' : 'text-red-400';
  const lsbuDateColorClass = lsbuStillInTime ? 'text-green-400' : 'text-red-400';
  
  const deadlinesDetailsHtml = `
    <div class="space-y-4">
        <div>
            <p class="font-semibold text-gray-300">
              <span class="inline-block w-6">${sfeStatusIcon}</span>SFE Year of Funding Deadline:
              <span class="font-bold ${sfeDateColorClass}">${formatDate(sfeDeadline)}</span>
              <span class="ml-2 text-sm text-gray-500">${sfeDaysText}</span>
              <span class="ml-2 py-1 px-2 bg-gray-700 text-xs rounded-md">SFE rule (external)</span>
            </p>
            <p class="text-sm text-gray-400 mt-1 pl-10">
              Withdraw or interrupt before the official course start date to avoid using a year of SFE funding.
            </p>
        </div>
        <div class="border-t border-gray-700"></div>
        <div>
            <p class="font-semibold text-gray-300">
              <span class="inline-block w-6">${lsbuStatusIcon}</span>LSBU Fee Liability Deadline:
              <span class="font-bold ${lsbuDateColorClass}">${formatDate(lsbuFeeLiabilityDeadline)}</span>
              <span class="ml-2 text-sm text-gray-500">${lsbuDaysText}</span>
              <span class="ml-2 py-1 px-2 bg-gray-700 text-xs rounded-md">LSBU rule (internal)</span>
            </p>
            <p class="text-sm text-gray-400 mt-1 pl-10">
              Per LSBU Tuition Fee Regulations 2025/26, section 23.5 — last date to withdraw or interrupt without tuition fee liability.
            </p>
        </div>
    </div>
  `;

  const collapsibleSectionHtml = `
    <div>
        <button onclick="toggleDetails()" class="w-full flex justify-between items-center text-left text-gray-300 font-semibold p-3 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition">
            <span>View Deadline Breakdown</span>
            <i id="details-arrow" class="fas fa-chevron-down transition-transform"></i>
        </button>
        <div id="deadlineDetails" class="hidden p-4 mt-2 bg-gray-900/50 rounded-lg">
            ${deadlinesDetailsHtml}
        </div>
    </div>
  `;

  let sfeStatusHtml = '';
  if (sfeStillInTime) {
    sfeStatusHtml = `
      <div class="bg-green-900/50 border border-green-700 text-green-300 rounded-lg p-4 flex items-center gap-4">
        <i class="fas fa-check-circle fa-2x"></i>
        <div>
          <p class="font-semibold">SFE Funding Deadline: Within deadline</p>
          <p class="text-sm font-normal text-green-400/80">Withdraw or interrupt by <span class="font-bold">${formatDate(sfeDeadline)}</span> to avoid using a year of SFE funding.</p>
        </div>
      </div>`;
  } else {
    sfeStatusHtml = `
      <div class="bg-red-900/50 border border-red-700 text-red-300 rounded-lg p-4 flex items-center gap-4">
        <i class="fas fa-times-circle fa-2x"></i>
        <div>
          <p class="font-semibold">SFE Funding Deadline: Deadline passed</p>
          <p class="text-sm font-normal text-red-400/80">You have passed the deadline; a year of SFE funding will be used.</p>
        </div>
      </div>`;
  }

  let lsbuStatusHtml = '';
  if (lsbuStillInTime) {
    lsbuStatusHtml = `
      <div class="bg-green-900/50 border border-green-700 text-green-300 rounded-lg p-4 flex items-center gap-4">
        <i class="fas fa-check-circle fa-2x"></i>
        <div>
          <p class="font-semibold">LSBU Fee Liability Deadline: Within deadline</p>
          <p class="text-sm font-normal text-green-400/80">Withdraw or interrupt by <span class="font-bold">${formatDate(lsbuFeeLiabilityDeadline)}</span> to avoid tuition fee charges.</p>
        </div>
      </div>`;
  } else {
    lsbuStatusHtml = `
      <div class="bg-red-900/50 border border-red-700 text-red-300 rounded-lg p-4 flex items-center gap-4">
        <i class="fas fa-times-circle fa-2x"></i>
        <div>
          <p class="font-semibold">LSBU Fee Liability Deadline: Deadline passed</p>
          <p class="text-sm font-normal text-red-400/80">You have passed the deadline and may be liable for tuition fees.</p>
        </div>
      </div>`;
  }

  const trafficLightHtml = `
    <div class="mt-6 space-y-4">
      ${sfeStatusHtml}
      ${lsbuStatusHtml}
    </div>
  `;

  out.innerHTML = collapsibleSectionHtml + '<div class="border-t border-gray-700 my-6"></div>' + trafficLightHtml;
}
</script>

</body>
</html>




